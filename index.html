<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë…ì„œì‹¤ í™”ì¥ì‹¤ ì™¸ì¶œ ê´€ë¦¬</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸš»</text></svg>">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Malgun Gothic', 'Apple SD Gothic Neo', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            padding: 30px;
            text-align: center;
            position: relative;
        }

        .header h1 {
            font-size: 28px;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .header p {
            font-size: 16px;
            opacity: 0.9;
        }

        .admin-toggle {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .admin-toggle:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .main-content {
            padding: 30px;
        }

        .input-section {
            background: #f8f9ff;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            border: 2px solid #e1e8ff;
        }

        .input-group {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .input-field {
            flex: 1;
            min-width: 150px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
            font-size: 14px;
        }

        input[type="text"], input[type="number"] {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #dde4ff;
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s ease;
            background: white;
        }

        input[type="text"]:focus, input[type="number"]:focus {
            outline: none;
            border-color: #4facfe;
            box-shadow: 0 0 0 3px rgba(79, 172, 254, 0.1);
        }

        input[readonly] {
            background: #f0f0f0 !important;
            color: #666 !important;
            cursor: not-allowed;
        }

        .button-group {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(79, 172, 254, 0.3);
        }

        .btn-demo {
            background: linear-gradient(135deg, #17a2b8 0%, #138496 100%);
            color: white;
        }

        .btn-demo:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(23, 162, 184, 0.3);
        }

        .btn-danger {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a52 100%);
            color: white;
        }

        .btn-danger:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(255, 107, 107, 0.3);
        }

        .btn-admin {
            background: linear-gradient(135deg, #9c27b0 0%, #673ab7 100%);
            color: white;
        }

        .btn-admin:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(156, 39, 176, 0.3);
        }

        .active-list {
            background: white;
            border-radius: 15px;
            margin-bottom: 30px;
            border: 2px solid #e1e8ff;
            overflow: hidden;
        }

        .list-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            font-weight: 600;
            font-size: 18px;
        }

        .list-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            border-bottom: 1px solid #f0f0f0;
            transition: all 0.3s ease;
        }

        .list-item:hover {
            background: #f8f9ff;
        }

        .list-item:last-child {
            border-bottom: none;
        }

        .user-info {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .user-name {
            font-weight: 600;
            font-size: 16px;
            color: #333;
        }

        .user-number {
            color: #666;
            font-size: 14px;
        }

        .timer-info {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
        }

        .timer {
            font-weight: 700;
            font-size: 20px;
            color: #4facfe;
        }

        .timer.warning {
            color: #ff6b00;
        }

        .timer.danger {
            color: #f44336;
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .status {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }

        .status.normal {
            background: #e8f5e8;
            color: #4caf50;
        }

        .status.warning {
            background: #fff3cd;
            color: #ff6b00;
        }

        .status.danger {
            background: #ffeaea;
            color: #f44336;
        }

        .return-btn {
            background: #4caf50;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .return-btn:hover {
            background: #45a049;
            transform: translateY(-1px);
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            border: 2px solid #e1e8ff;
        }

        .stat-number {
            font-size: 32px;
            font-weight: 700;
            color: #4facfe;
            margin-bottom: 10px;
        }

        .stat-label {
            color: #666;
            font-size: 14px;
        }

        .empty-state {
            text-align: center;
            padding: 40px;
            color: #666;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #4caf50;
            color: white;
            padding: 15px 20px;
            border-radius: 10px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
            z-index: 1000;
            animation: slideIn 0.3s ease;
            max-width: 350px;
        }

        .notification.warning {
            background: #ff6b6b;
        }

        .notification.info {
            background: #17a2b8;
        }

        @keyframes slideIn {
            from { transform: translateX(100%); }
            to { transform: translateX(0); }
        }

        .footer {
            text-align: center;
            padding: 20px;
            background: #f8f9ff;
            color: #666;
            font-size: 14px;
        }

        /* ê´€ë¦¬ì ëª¨ë“œ ìŠ¤íƒ€ì¼ */
        .admin-panel {
            background: #fff8e1;
            border: 2px solid #ffcc02;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            display: none;
        }

        .admin-panel.active {
            display: block;
        }

        .admin-title {
            color: #f57c00;
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .seat-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid #ddd;
            border-radius: 10px;
            padding: 15px;
            background: white;
        }

        .seat-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            background: #fafafa;
        }

        .seat-number {
            font-weight: 600;
            color: #333;
            min-width: 40px;
        }

        .seat-name-input {
            flex: 1;
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
        }

        .admin-actions {
            margin-top: 20px;
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        @media (max-width: 768px) {
            .input-group {
                flex-direction: column;
            }

            .button-group, .admin-actions {
                flex-direction: column;
            }

            .list-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }

            .timer-info {
                align-items: flex-start;
            }

            .stats {
                grid-template-columns: 1fr;
            }

            .admin-toggle {
                position: relative;
                top: 0;
                right: 0;
                margin-top: 10px;
            }

            .seat-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸš» ë…ì„œì‹¤ í™”ì¥ì‹¤ ì™¸ì¶œ ê´€ë¦¬</h1>
            <p>íš¨ìœ¨ì ì¸ í™”ì¥ì‹¤ ì´ìš© ì‹œê°„ ê´€ë¦¬ ì‹œìŠ¤í…œ (ì œí•œì‹œê°„: 10ë¶„)</p>
            <button class="admin-toggle" onclick="toggleAdminMode()">
                ğŸ”§ ê´€ë¦¬ì ëª¨ë“œ
            </button>
        </div>

        <div class="main-content">
            <!-- ê´€ë¦¬ì íŒ¨ë„ -->
            <div class="admin-panel" id="adminPanel">
                <div class="admin-title">
                    ğŸ”§ ì¢Œì„ ì •ë³´ ê´€ë¦¬
                </div>
                <p style="margin-bottom: 20px; color: #666;">ì¢Œì„ ë²ˆí˜¸ë³„ ì´ë¦„ì„ ìˆ˜ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë³€ê²½ í›„ ì €ì¥ ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”.</p>
                <div class="seat-grid" id="seatGrid">
                    <!-- ì¢Œì„ ì •ë³´ê°€ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤ -->
                </div>
                <div class="admin-actions">
                    <button class="btn btn-admin" onclick="saveSeatData()">
                        ğŸ’¾ ë³€ê²½ì‚¬í•­ ì €ì¥
                    </button>
                    <button class="btn btn-demo" onclick="resetToDefault()">
                        ğŸ”„ ê¸°ë³¸ê°’ìœ¼ë¡œ ë³µì›
                    </button>
                    <button class="btn btn-danger" onclick="clearAllSeats()">
                        ğŸ—‘ï¸ ëª¨ë“  ì¢Œì„ ë¹„ìš°ê¸°
                    </button>
                </div>
            </div>

            <div class="stats">
                <div class="stat-card">
                    <div class="stat-number" id="totalOut">0</div>
                    <div class="stat-label">í˜„ì¬ ì™¸ì¶œ ì¤‘</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="totalWarning">0</div>
                    <div class="stat-label">ì‹œê°„ ì´ˆê³¼</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="todayTotal">0</div>
                    <div class="stat-label">ì˜¤ëŠ˜ ì´ ì™¸ì¶œ</div>
                </div>
            </div>

            <div class="input-section">
                <div class="input-group">
                    <div class="input-field">
                        <label for="studentNumber">í•™ìƒ ë²ˆí˜¸</label>
                        <input type="text" id="studentNumber" placeholder="ì¢Œì„ ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”" autocomplete="off">
                    </div>
                    <div class="input-field">
                        <label for="studentName">ì´ë¦„</label>
                        <input type="text" id="studentName" placeholder="ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”" autocomplete="off">
                    </div>
                    <div class="input-field">
                        <label for="timeLimit">ì œí•œ ì‹œê°„</label>
                        <input type="text" value="10ë¶„ (ê³ ì •)" readonly>
                    </div>
                </div>
                <div class="button-group">
                    <button class="btn btn-primary" onclick="startRestroom()">
                        ğŸš» í™”ì¥ì‹¤ ì™¸ì¶œ
                    </button>
                    <button class="btn btn-demo" onclick="addDemoData()">
                        ğŸ¬ ë°ëª¨ ë³´ê¸°
                    </button>
                    <button class="btn btn-danger" onclick="clearAll()">
                        ğŸ”„ ì „ì²´ ì´ˆê¸°í™”
                    </button>
                </div>
            </div>

            <div class="active-list">
                <div class="list-header">
                    ğŸ“‹ í˜„ì¬ ì™¸ì¶œ ì¤‘ì¸ í•™ìƒ ëª©ë¡
                </div>
                <div id="activeList">
                    <div class="empty-state">
                        í˜„ì¬ ì™¸ì¶œ ì¤‘ì¸ í•™ìƒì´ ì—†ìŠµë‹ˆë‹¤.
                    </div>
                </div>
            </div>
        </div>

        <div class="footer">
            Â© 2025 ë…ì„œì‹¤ í™”ì¥ì‹¤ ì™¸ì¶œ ê´€ë¦¬ ì‹œìŠ¤í…œ | 
            GitHub Pagesë¡œ í˜¸ìŠ¤íŒ… | 
            ë¬¸ì˜: ê°œë°œìì—ê²Œ ì—°ë½
        </div>
    </div>

    <script>
        // ê¸°ë³¸ ë…ì„œì‹¤ ì¢Œì„ ì •ë³´
        const defaultSeatData = {
            41: "ê¹€ì•„ë¦„", 34: "ì •ì˜ˆë¹ˆ", 27: "ê¹€í˜„ë‚˜", 20: "ì´ì„œì—°2", 14: "ê¹€ìœ ì§„2", 8: "ì§„ì„¸í¬", 1: "ì‹ ì§€ìœ¤",
            42: "í•œì˜ˆë¦°", 35: "ê¹€ì†œ", 28: "ë¬¸ì§€í˜„", 21: "ê¹€ë¯¼ì„±3", 15: "ê¹€ë„ìœ¤2", 9: "ê¹€ì„œì˜", 2: "ê¹€ì¤€ì„±",
            43: "ë°•ì£¼ì—°", 36: "ì´ì¬ì›", 29: "í•œì¬ì›", 22: "ê¹€ì„œìœ¤3", 16: "êµ¬ì›ëª¨", 10: "íŒ€ëª…ì„œ2", 3: "ì´ìœ ì§„2",
            44: "ë°°ì¤€í˜¸", 37: "ì„±ì—°ì£¼", 30: "ì •ì‹œí˜„", 23: "ì´ìƒí˜„2", 17: "ê¹€íƒœì„ ", 11: "ì¥ìœ ì§„2", 4: "í™©ìŠ¹í•˜",
            45: "ì •ì€ìœ ", 38: "ì˜¤ì‹œí˜„", 31: "ì´ì˜ˆì›", 24: "ì •ë¯¼ì„±", 18: "ì„ì˜ˆì¤€2", 12: "ì´ì„œì€3", 5: "ê¹€ë‹¤ì •",
            46: "ìµœë™ë¹ˆ2", 39: "ë°•ì„œì˜", 32: "ë°•ìŠ¹ì±„", 25: "ì „ì¤€í˜", 19: "ì •ë¯¼ì¤€", 13: "ë°±ì§€ìœ¤", 6: "ê¹€ë‚˜ê²½",
            47: "", 40: "ê¹€ìˆ˜ë¯¼3", 33: "ë°•ì‹œí˜„2", 26: "ê¹€ê±´ìš°", 7: "ìµœë¯¼ì„œ"
        };

        // í˜„ì¬ ì¢Œì„ ë°ì´í„° (ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì—ì„œ ë¶ˆëŸ¬ì˜¤ê±°ë‚˜ ê¸°ë³¸ê°’ ì‚¬ìš©)
        let seatData = JSON.parse(JSON.stringify(defaultSeatData));

        let activeUsers = [];
        let timers = {};
        let todayCount = 0;
        let isAdminMode = false;

        // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì—ì„œ ì¢Œì„ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
        function loadSeatData() {
            const stored = localStorage.getItem('restroomSeatData');
            if (stored) {
                try {
                    seatData = JSON.parse(stored);
                } catch (e) {
                    console.log('ì €ì¥ëœ ì¢Œì„ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨, ê¸°ë³¸ê°’ ì‚¬ìš©');
                    seatData = JSON.parse(JSON.stringify(defaultSeatData));
                }
            }
        }

        // ì¢Œì„ ë°ì´í„°ë¥¼ ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì— ì €ì¥
        function saveSeatDataToStorage() {
            localStorage.setItem('restroomSeatData', JSON.stringify(seatData));
        }

        // ê´€ë¦¬ì ëª¨ë“œ í† ê¸€
        function toggleAdminMode() {
            isAdminMode = !isAdminMode;
            const panel = document.getElementById('adminPanel');
            const toggle = document.querySelector('.admin-toggle');
            
            if (isAdminMode) {
                panel.classList.add('active');
                toggle.textContent = 'âŒ ê´€ë¦¬ì ëª¨ë“œ ë‹«ê¸°';
                renderSeatGrid();
            } else {
                panel.classList.remove('active');
                toggle.textContent = 'ğŸ”§ ê´€ë¦¬ì ëª¨ë“œ';
            }
        }

        // ì¢Œì„ ê·¸ë¦¬ë“œ ë Œë”ë§
        function renderSeatGrid() {
            const grid = document.getElementById('seatGrid');
            const seatNumbers = Object.keys(seatData).sort((a, b) => parseInt(a) - parseInt(b));
            
            grid.innerHTML = seatNumbers.map(number => `
                <div class="seat-item">
                    <div class="seat-number">${number}ë²ˆ</div>
                    <input 
                        type="text" 
                        class="seat-name-input" 
                        value="${seatData[number] || ''}" 
                        placeholder="ì´ë¦„ ì…ë ¥"
                        data-seat="${number}"
                    >
                </div>
            `).join('');
        }

        // ì¢Œì„ ë°ì´í„° ì €ì¥
        function saveSeatData() {
            const inputs = document.querySelectorAll('.seat-name-input');
            inputs.forEach(input => {
                const seatNumber = input.dataset.seat;
                seatData[seatNumber] = input.value.trim();
            });
            
            saveSeatDataToStorage();
            showNotification('ì¢Œì„ ì •ë³´ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!');
        }

        // ê¸°ë³¸ê°’ìœ¼ë¡œ ë³µì›
        function resetToDefault() {
            if (confirm('ëª¨ë“  ì¢Œì„ ì •ë³´ë¥¼ ê¸°ë³¸ê°’ìœ¼ë¡œ ë³µì›í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                seatData = JSON.parse(JSON.stringify(defaultSeatData));
                saveSeatDataToStorage();
                renderSeatGrid();
                showNotification('ê¸°ë³¸ê°’ìœ¼ë¡œ ë³µì›ë˜ì—ˆìŠµë‹ˆë‹¤.');
            }
        }

        // ëª¨ë“  ì¢Œì„ ë¹„ìš°ê¸°
        function clearAllSeats() {
            if (confirm('ëª¨ë“  ì¢Œì„ì˜ ì´ë¦„ì„ ë¹„ìš°ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                Object.keys(seatData).forEach(key => {
                    seatData[key] = '';
                });
                saveSeatDataToStorage();
                renderSeatGrid();
                showNotification('ëª¨ë“  ì¢Œì„ì´ ë¹„ì›Œì¡ŒìŠµë‹ˆë‹¤.');
            }
        }

        function updateStats() {
            document.getElementById('totalOut').textContent = activeUsers.length;
            document.getElementById('totalWarning').textContent = activeUsers.filter(user => user.isOvertime).length;
            document.getElementById('todayTotal').textContent = todayCount;
        }

        function showNotification(message, type = 'success') {
            // ê¸°ì¡´ ì•Œë¦¼ ì œê±°
            const existingNotifications = document.querySelectorAll('.notification');
            existingNotifications.forEach(n => n.remove());

            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 4000);
        }

        function formatTime(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = seconds % 60;
            return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
        }

        function getTimerStatus(remainingTime) {
            if (remainingTime > 300) return 'normal'; // 5ë¶„ ì´ìƒ
            if (remainingTime > 0) return 'warning'; // 5ë¶„ ì´í•˜
            return 'danger'; // ì‹œê°„ ì´ˆê³¼
        }

        function startRestroom() {
            const number = document.getElementById('studentNumber').value.trim();
            const name = document.getElementById('studentName').value.trim();
            const timeLimit = 10; // 10ë¶„ ê³ ì •

            if (!number) {
                showNotification('í•™ìƒ ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.', 'warning');
                document.getElementById('studentNumber').focus();
                return;
            }

            // ì¢Œì„í‘œì—ì„œ ì´ë¦„ ìë™ ì™„ì„±
            let finalName = name;
            if (seatData[number] && seatData[number] !== "") {
                finalName = seatData[number];
            } else if (!name) {
                showNotification('ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.', 'warning');
                document.getElementById('studentName').focus();
                return;
            }

            // ì´ë¯¸ ì™¸ì¶œ ì¤‘ì¸ì§€ í™•ì¸
            if (activeUsers.find(user => user.number === number)) {
                showNotification(`${finalName}ë‹˜ì€ ì´ë¯¸ ì™¸ì¶œ ì¤‘ì…ë‹ˆë‹¤.`, 'warning');
                return;
            }

            const user = {
                number: number,
                name: finalName,
                startTime: Date.now(),
                timeLimit: timeLimit * 60, // ì´ˆ ë‹¨ìœ„ë¡œ ë³€í™˜ (10ë¶„ = 600ì´ˆ)
                isOvertime: false
            };

            activeUsers.push(user);
            todayCount++;
            
            startTimer(user);
            updateActiveList();
            updateStats();
            
            showNotification(`${finalName}ë‹˜ì´ í™”ì¥ì‹¤ë¡œ ì™¸ì¶œí–ˆìŠµë‹ˆë‹¤. (ì œí•œì‹œê°„: 10ë¶„)`, 'info');
            
            // ì…ë ¥ í•„ë“œ ì´ˆê¸°í™”
            document.getElementById('studentNumber').value = '';
            document.getElementById('studentName').value = '';
            document.getElementById('studentNumber').focus();
        }

        function startTimer(user) {
            const timerId = setInterval(() => {
                const elapsed = Math.floor((Date.now() - user.startTime) / 1000);
                const remaining = user.timeLimit - elapsed;
                
                if (remaining <= 0 && !user.isOvertime) {
                    user.isOvertime = true;
                    showNotification(`âš ï¸ ${user.name}ë‹˜ì˜ ì™¸ì¶œ ì‹œê°„ì´ ì´ˆê³¼ë˜ì—ˆìŠµë‹ˆë‹¤!`, 'warning');
                    
                    // ì†Œë¦¬ ì•Œë¦¼ (ë¸Œë¼ìš°ì €ì—ì„œ ì§€ì›í•˜ëŠ” ê²½ìš°)
                    try {
                        if ('speechSynthesis' in window) {
                            const utterance = new SpeechSynthesisUtterance(`${user.name}ë‹˜ì˜ ì™¸ì¶œ ì‹œê°„ì´ ì´ˆê³¼ë˜ì—ˆìŠµë‹ˆë‹¤`);
                            utterance.lang = 'ko-KR';
                            utterance.rate = 0.8;
                            speechSynthesis.speak(utterance);
                        }
                    } catch (e) {
                        console.log('ìŒì„± ì•Œë¦¼ ì§€ì›ë˜ì§€ ì•ŠìŒ');
                    }
                }
                
                updateActiveList();
                updateStats();
            }, 1000);
            
            timers[user.number] = timerId;
        }

        function returnUser(number) {
            const userIndex = activeUsers.findIndex(user => user.number === number);
            if (userIndex !== -1) {
                const user = activeUsers[userIndex];
                clearInterval(timers[number]);
                delete timers[number];
                activeUsers.splice(userIndex, 1);
                
                updateActiveList();
                updateStats();
                showNotification(`${user.name}ë‹˜ì´ ë³µê·€í–ˆìŠµë‹ˆë‹¤.`);
            }
        }

        function updateActiveList() {
            const listContainer = document.getElementById('activeList');
            
            if (activeUsers.length === 0) {
                listContainer.innerHTML = '<div class="empty-state">í˜„ì¬ ì™¸ì¶œ ì¤‘ì¸ í•™ìƒì´ ì—†ìŠµë‹ˆë‹¤.</div>';
                return;
            }
            
            listContainer.innerHTML = activeUsers.map(user => {
                const elapsed = Math.floor((Date.now() - user.startTime) / 1000);
                const remaining = user.timeLimit - elapsed;
                const status = getTimerStatus(remaining);
                const timeDisplay = remaining > 0 ? formatTime(remaining) : formatTime(Math.abs(remaining));
                const statusText = remaining > 0 ? 'ë‚¨ì€ ì‹œê°„' : 'ì´ˆê³¼ ì‹œê°„';
                
                return `
                    <div class="list-item">
                        <div class="user-info">
                            <div class="user-name">${user.name}</div>
                            <div class="user-number">ì¢Œì„ ë²ˆí˜¸: ${user.number}</div>
                        </div>
                        <div class="timer-info">
                            <div class="timer ${status}">${timeDisplay}</div>
                            <div class="status ${status}">${statusText}</div>
                        </div>
                        <button class="return-btn" onclick="returnUser('${user.number}')">
                            ë³µê·€ ì™„ë£Œ
                        </button>
                    </div>
                `;
            }).join('');
        }

        function clearAll() {
            if (activeUsers.length === 0) {
                showNotification('ì´ˆê¸°í™”í•  ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.', 'warning');
                return;
            }
            
            if (confirm('ëª¨ë“  ì™¸ì¶œ ê¸°ë¡ì„ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                Object.values(timers).forEach(timer => clearInterval(timer));
                timers = {};
                activeUsers = [];
                todayCount = 0;
                updateActiveList();
                updateStats();
                showNotification('ëª¨ë“  ë°ì´í„°ê°€ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.');
            }
        }

        // ë°ëª¨ ë°ì´í„° ì¶”ê°€ í•¨ìˆ˜
        function addDemoData() {
            if (activeUsers.length > 0) {
                if (!confirm('í˜„ì¬ ë°ì´í„°ê°€ ìˆìŠµë‹ˆë‹¤. ë°ëª¨ë¥¼ ì¶”ê°€í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                    return;
                }
            }

            // ë°ëª¨ìš© ì‚¬ìš©ìë“¤ ì¶”ê°€ (ëª¨ë‘ 10ë¶„ ì œí•œ)
            const demoUsers = [
                { number: "27", timeLimit: 10 * 60, elapsed: 6 * 60 }, // 6ë¶„ ê²½ê³¼
                { number: "42", timeLimit: 10 * 60, elapsed: 12 * 60 }, // 2ë¶„ ì´ˆê³¼
                { number: "15", timeLimit: 10 * 60, elapsed: 3 * 60 }, // 3ë¶„ ê²½ê³¼
            ];

            demoUsers.forEach(demo => {
                // ì¤‘ë³µ ì²´í¬
                if (!activeUsers.find(user => user.number === demo.number)) {
                    const name = seatData[demo.number] || `í•™ìƒ${demo.number}`;
                    const user = {
                        number: demo.number,
                        name: name,
                        startTime: Date.now() - (demo.elapsed * 1000),
                        timeLimit: demo.timeLimit,
                        isOvertime: demo.elapsed > demo.timeLimit
                    };
                    
                    activeUsers.push(user);
                    startTimer(user);
                }
            });

            if (todayCount < 10) {
                todayCount = 12; // ì˜¤ëŠ˜ ì´ ì™¸ì¶œ íšŸìˆ˜
            }
            
            updateActiveList();
            updateStats();
            
            showNotification('ë°ëª¨ ë°ì´í„°ê°€ ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤! ì‹¤ì‹œê°„ìœ¼ë¡œ í™•ì¸í•´ë³´ì„¸ìš”.', 'info');
        }

        // ì¢Œì„ ë²ˆí˜¸ ì…ë ¥ ì‹œ ìë™ ì´ë¦„ ì™„ì„±
        document.getElementById('studentNumber').addEventListener('input', function(e) {
            const number = e.target.value.trim();
            const nameField = document.getElementById('studentName');
            
            if (seatData[number] && seatData[number] !== "") {
                nameField.value = seatData[number];
                nameField.style.backgroundColor = '#e8f5e8';
                nameField.style.borderColor = '#4caf50';
            } else {
                if (nameField.value === seatData[e.target.dataset.lastNumber]) {
                    nameField.value = '';
                }
                nameField.style.backgroundColor = '';
                nameField.style.borderColor = '#dde4ff';
            }
            
            e.target.dataset.lastNumber = number;
        });

        // ì—”í„°í‚¤ë¡œ ì™¸ì¶œ ì‹œì‘
        document.addEventListener('keypress', function(e) {
            if (e.key === 'Enter' && !isAdminMode) {
                startRestroom();
            }
        });

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', function() {
            loadSeatData(); // ì €ì¥ëœ ì¢Œì„ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
            updateStats();
            updateActiveList();
            document.getElementById('studentNumber').focus();
            
            // ì›¹í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ ì•Œë¦¼
            setTimeout(() => {
                showNotification('ë…ì„œì‹¤ í™”ì¥ì‹¤ ì™¸ì¶œ ê´€ë¦¬ ì‹œìŠ¤í…œì´ ì¤€ë¹„ë˜ì—ˆìŠµë‹ˆë‹¤!', 'info');
            }, 1000);
        });

        // 5ë¶„ë§ˆë‹¤ ìƒíƒœ ì ê²€
        setInterval(() => {
            const overtimeUsers = activeUsers.filter(user => user.isOvertime);
            if (overtimeUsers.length > 0) {
                console.log(`í˜„ì¬ ${overtimeUsers.length}ëª…ì´ ì‹œê°„ ì´ˆê³¼ ìƒíƒœì…ë‹ˆë‹¤.`);
            }
        }, 300000); // 5ë¶„ë§ˆë‹¤

        // í˜ì´ì§€ ì–¸ë¡œë“œ ì‹œ í™•ì¸
        window.addEventListener('beforeunload', function(e) {
            if (activeUsers.length > 0) {
                e.returnValue = 'í˜„ì¬ ì™¸ì¶œ ì¤‘ì¸ í•™ìƒì´ ìˆìŠµë‹ˆë‹¤. í˜ì´ì§€ë¥¼ ë‚˜ê°€ì‹œê² ìŠµë‹ˆê¹Œ?';
            }
        });
    </script>
</body>
</html>
